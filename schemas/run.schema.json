{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Test Execution Run Schema",
  "description": "Schema for test execution traces generated by the Operator",
  "type": "object",
  "required": [
    "testName",
    "steps",
    "finalState"
  ],
  "properties": {
    "testName": {
      "type": "string",
      "description": "Name of the test that was executed"
    },
    "startTime": {
      "type": "string",
      "description": "ISO timestamp when execution started"
    },
    "endTime": {
      "type": "string",
      "description": "ISO timestamp when execution ended"
    },
    "duration": {
      "type": "number",
      "description": "Duration in seconds"
    },
    "steps": {
      "type": "array",
      "description": "Execution trace of each step",
      "items": {
        "type": "object",
        "required": [
          "stepNumber",
          "action",
          "result",
          "description"
        ],
        "properties": {
          "stepNumber": {
            "type": "integer",
            "description": "Step number (1-indexed)"
          },
          "action": {
            "type": "string",
            "description": "Action that was executed"
          },
          "target": {
            "description": "Target of the action (URL or element description)"
          },
          "selector": {
            "type": [
              "string",
              "null"
            ],
            "description": " The precise Playwright selector used during execution (e.g. getByRole('button', {name: 'Login'}))"
          },
          "selectorType": {
            "type": [
              "string",
              "null"
            ],
            "description": "The type of selector strategy used"
          },
          "value": {
            "type": "string",
            "description": "Value used (for fill actions)"
          },
          "snapshot": {
            "oneOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "description": "Accessibility snapshot before action (if available)"
          },
          "result": {
            "type": "string",
            "enum": [
              "success",
              "failure",
              "skipped",
              "failed"
            ],
            "description": "Result of executing this step"
          },
          "error": {
            "oneOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "description": "Error message if step failed"
          },
          "screenshot": {
            "oneOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "description": "Path to screenshot file (if taken)"
          },
          "timestamp": {
            "type": "string",
            "description": "ISO timestamp when step executed"
          },
          "details": {
            "type": "string",
            "description": "Additional details about what happened"
          },
          "description": {
            "type": "string",
            "description": "Human-readable description of the step"
          }
        }
      }
    },
    "finalState": {
      "type": "string",
      "enum": [
        "passed",
        "failed",
        "error"
      ],
      "description": "Final test result"
    },
    "summary": {
      "type": "string",
      "description": "Summary of what happened during execution"
    },
    "successCount": {
      "type": "integer",
      "description": "Number of successful steps"
    },
    "failureCount": {
      "type": "integer",
      "description": "Number of failed steps"
    }
  }
}